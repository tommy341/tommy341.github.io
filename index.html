<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>workspace</title>
    
    <!-- Open Graph Meta Tags for Discord/Twitter/Facebook embeds -->
    <meta property="og:title" content="workspace">
    <meta property="og:description" content="A comprehensive collection of Deepwoken software. Everything you need in one place.">
    <meta property="og:image" content="https://tommy341.github.io/terminal.webp">
    <meta property="og:url" content="https://tommy341.github.io">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="workspace">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="workspace">
    <meta name="twitter:description" content="A comprehensive collection of Deepwoken software. Everything you need in one place.">
    <meta name="twitter:image" content="https://tommy341.github.io/terminal.webp">
    
    <!-- Additional Meta Tags -->
    <meta name="description" content="A comprehensive collection of Deepwoken software. Everything you need in one place.">
    <meta name="keywords" content="terminal, desktop, applications, deepwoken, software, collection">
    <meta name="author" content="workspace">
    
    <link rel="icon" type="image/webp" href="terminal.webp">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000000;
            color: #cccccc;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            min-height: 100vh;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        .terminal {
            width: 50vw;
            height: 60vh;
            position: absolute;
            top: 50px;
            left: calc(50vw - 25vw);
            min-width: 600px;
            min-height: 500px;
            outline: none;
            display: none;
        }

        .desktop-icon {
            position: absolute;
            top: 35%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
            user-select: none;
            width: 120px;
            height: 135px;
        }

        #terminal-icon {
            left: 25%;
        }

        #mail-icon {
            left: 34%;
        }

        #discord-icon {
            left: 43%;
        }

        #finder-icon {
            left: 52%;
        }

        #deepwoken-icon {
            left: 61%;
        }

        .desktop-icon:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .desktop-icon.selected {
            background-color: rgba(0, 123, 255, 0.3);
        }

        .desktop-icon img {
            width: 80px;
            height: 80px;
            margin-bottom: 8px;
        }

        .desktop-icon-text {
            color: #ffffff;
            font-size: 14px;
            text-align: center;
            white-space: nowrap;
        }

        .terminal-header {
            background: #1a1a1a;
            padding: 10px 15px;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: move;
            user-select: none;
        }

        .terminal-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .terminal-header-right {
            display: flex;
            align-items: center;
        }

        .terminal-icon {
            width: 32px;
            height: 32px;
            flex-shrink: 0;
        }

        .close-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff5f57;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: background-color 0.2s ease;
        }

        .close-button:hover {
            background: #ff3b30;
        }

        .close-button::before {
            content: '×';
            color: #000;
            font-size: 10px;
            font-weight: bold;
            line-height: 1;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .close-button:hover::before {
            opacity: 1;
        }

        .terminal-dots {
            display: flex;
            gap: 6px;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot.red { background: #cc0000; }
        .dot.yellow { background: #cc9900; }
        .dot.green { background: #00cc00; }

        .terminal-title {
            color: #888888;
            font-size: 12px;
        }

        .terminal-body {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 0 0 8px 8px;
            height: calc(100% - 50px);
            overflow-y: auto;
        }

        .prompt {
            color: #ffffff;
            font-weight: 600;
        }

        .command {
            color: #cccccc;
        }

        .output {
            color: #888888;
            margin-left: 20px;
        }

        .cursor {
            display: inline-block;
            width: 8px;
            height: 4px;
            background: #cccccc;
            animation: blink 1s infinite;
            vertical-align: baseline;
            margin-left: 0;
            margin-right: -8px;
            transform: translateY(6px);
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .help-text {
            color: #666666;
            margin: 20px 0;
        }

        .help-command {
            color: #cc9900;
            font-weight: 600;
        }

        .suggestion {
            color: #666666;
            opacity: 0.7;
        }

        /* Mail App Styles - Minimal Update Logs */
        .mail-app {
            width: 60vw;
            height: 70vh;
            position: absolute;
            top: 15vh;
            left: 20vw;
            min-width: 600px;
            min-height: 400px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            overflow: hidden;
            outline: none;
        }

        .mail-header {
            background: #f8f8f8;
            padding: 12px 20px;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e0e0e0;
            cursor: move;
            user-select: none;
        }

        .mail-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mail-header-right {
            display: flex;
            align-items: center;
        }

        .mail-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .mail-title {
            color: #333333;
            font-size: 16px;
            font-weight: 600;
            line-height: 1;
        }

        .mail-content {
            flex: 1;
            overflow-y: auto;
            background: white;
        }

        .update-list {
            padding: 20px;
        }

        .update-item {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .update-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .update-date {
            color: #666;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .update-title {
            color: #333;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .update-content {
            color: #555;
            font-size: 14px;
            line-height: 1.6;
        }

        /* Desktop selection box */
        .selection-box {
            position: absolute;
            border: 2px solid #007AFF;
            background: rgba(0, 122, 255, 0.2);
            pointer-events: none;
            z-index: 10000;
            display: none;
        }

        .desktop-icon.selected-multiple {
            background-color: rgba(0, 123, 255, 0.5);
        }

        /* Disable text selection during dragging */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Finder App Styles */
        .finder-app {
            width: 70vw;
            height: 80vh;
            position: absolute;
            top: 10vh;
            left: 15vw;
            min-width: 800px;
            min-height: 600px;
            background: #f5f5f5;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            overflow: hidden;
            outline: none;
        }

        .finder-header {
            background: #e8e8e8;
            padding: 8px 15px;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #d0d0d0;
            cursor: move;
            user-select: none;
        }

        .finder-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .finder-nav-buttons {
            display: flex;
            gap: 5px;
        }

        .nav-button {
            width: 30px;
            height: 25px;
            border: 1px solid #ccc;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .nav-button:hover:not(:disabled) {
            background: #e0e0e0;
            border-color: #999;
        }

        .nav-button:disabled {
            background: #f5f5f5;
            color: #ccc;
            cursor: not-allowed;
            border-color: #e0e0e0;
        }

        .finder-traffic-lights {
            display: flex;
            gap: 6px;
        }

        .traffic-light {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .traffic-light.red { background: #ff5f57; }
        .traffic-light.yellow { background: #ffbd2e; }
        .traffic-light.green { background: #28ca42; }

        .finder-title {
            color: #333;
            font-size: 14px;
            font-weight: 500;
        }

        .finder-toolbar {
            background: #f0f0f0;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #d0d0d0;
        }

        .finder-nav {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-arrow {
            width: 20px;
            height: 20px;
            background: #d0d0d0;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            color: #666;
        }

        .nav-arrow:hover {
            background: #c0c0c0;
        }

        .finder-path {
            display: flex;
            align-items: center;
            gap: 5px;
            background: white;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #d0d0d0;
        }

        .path-icon {
            font-size: 12px;
        }

        .path-text {
            font-size: 12px;
            color: #333;
        }

        .finder-toolbar-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toolbar-icon {
            width: 24px;
            height: 24px;
            background: #e0e0e0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }

        .toolbar-icon:hover {
            background: #d0d0d0;
        }

        .finder-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .finder-main {
            flex: 1;
            padding: 20px;
            background: white;
        }

        .finder-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 20px;
        }

        .finder-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .finder-item:hover {
            background: #f0f0f0;
        }

        .finder-item.selected {
            background-color: rgba(0, 123, 255, 0.3);
        }

        .finder-item.selected-multiple {
            background-color: rgba(0, 123, 255, 0.5);
        }

        .finder-folder-icon {
            width: 60px;
            height: 60px;
            margin-bottom: 8px;
            object-fit: contain;
            flex-shrink: 0;
        }

        .finder-file-icon {
            width: 60px;
            height: 60px;
            margin-bottom: 8px;
            font-size: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Context Menu Styles */
        .context-menu {
            background: white;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 4px 0;
            min-width: 120px;
        }

        .context-item {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 13px;
            color: #333;
            transition: background-color 0.2s;
        }

        .context-item:hover {
            background: #f0f0f0;
        }

        /* Text Editor Styles */
        .text-editor {
            width: 60vw;
            height: 70vh;
            position: absolute;
            top: 15vh;
            left: 20vw;
            min-width: 600px;
            min-height: 400px;
            background: #1e1e1e;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            overflow: hidden;
            outline: none;
        }

        .text-editor-header {
            background: #2d2d2d;
            padding: 8px 15px;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #404040;
            cursor: move;
            user-select: none;
        }

        .text-editor-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .text-editor-title {
            color: #ffffff;
            font-size: 14px;
            font-weight: 500;
        }

        .text-editor-content {
            flex: 1;
            padding: 20px;
            background: #1e1e1e;
            overflow: auto;
        }

        #file-content {
            color: #d4d4d4;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .finder-label {
            font-size: 12px;
            color: #333;
            text-align: center;
            word-break: break-word;
        }

        .finder-status {
            background: #f0f0f0;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-top: 1px solid #d0d0d0;
        }

        .status-text {
            font-size: 12px;
            color: #666;
        }

        /* Deepwoken Updates App Styles - Copy of Text Editor */
        .deepwoken-updates-app {
            width: 60vw;
            height: 70vh;
            position: absolute;
            top: 15vh;
            left: 20vw;
            background: #1e1e1e;
            border: 2px solid #333;
            border-radius: 8px;
            display: none;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            outline: none;
        }

        .deepwoken-header {
            background: #2d2d2d;
            padding: 8px 15px;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: move;
            user-select: none;
        }

        .deepwoken-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .deepwoken-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .deepwoken-title {
            color: #ffffff;
            font-size: 14px;
            font-weight: 500;
        }

        .deepwoken-content {
            flex: 1;
            padding: 20px;
            background: #1e1e1e;
            overflow: auto;
            color: #cccccc;
            font-family: 'JetBrains Mono', monospace;
            line-height: 1.6;
        }

        .update-date {
            color: #4CAF50;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 1px solid #333;
            padding-bottom: 8px;
        }

        .update-content {
            white-space: pre-wrap;
            font-size: 13px;
            line-height: 1.6;
            color: #e6e6e6;
        }

        .loading {
            text-align: center;
            color: #888;
            font-style: italic;
        }

        .error {
            color: #ff6b6b;
            text-align: center;
        }

        .status-slider {
            width: 100px;
            height: 4px;
            background: #d0d0d0;
            border-radius: 2px;
            position: relative;
        }

        .slider-handle {
            width: 12px;
            height: 12px;
            background: #666;
            border-radius: 50%;
            position: absolute;
            top: -4px;
            left: 50%;
            transform: translateX(-50%);
        }
    </style>
</head>
<body>
    <div class="desktop-icon" id="terminal-icon" onclick="selectIcon('terminal')" ondblclick="openTerminal()">
        <img src="terminal.webp" alt="Terminal">
        <div class="desktop-icon-text">terminal.exe</div>
    </div>

    <div class="desktop-icon" id="mail-icon" onclick="selectIcon('mail')" ondblclick="openMail()">
        <img src="mail.png" alt="Mail">
        <div class="desktop-icon-text">mail.exe</div>
    </div>

    <div class="desktop-icon" id="discord-icon" onclick="selectIcon('discord')" ondblclick="openDiscord()">
        <img src="discord.png" alt="Discord">
        <div class="desktop-icon-text">discord.exe</div>
    </div>

    <div class="desktop-icon" id="finder-icon" onclick="selectIcon('finder')" ondblclick="openFinder()">
        <img src="Finder.png" alt="Finder">
        <div class="desktop-icon-text">Finder.app</div>
    </div>

    <div class="desktop-icon" id="deepwoken-icon" onclick="selectIcon('deepwoken')" ondblclick="openDeepwokenUpdates()">
        <img src="Deepwoken.png" alt="Deepwoken Updates">
        <div class="desktop-icon-text">Updates.app</div>
    </div>

    <div class="selection-box" id="selection-box"></div>

    <div class="terminal" id="terminal">
        <div class="terminal-header">
            <div class="terminal-header-left">
                <img src="terminal.webp" alt="Terminal" class="terminal-icon">
                <div class="terminal-title">terminal.exe</div>
            </div>
            <div class="terminal-header-right">
                <button class="close-button" onclick="closeTerminal()"></button>
            </div>
        </div>
        
        <div class="terminal-body">
            <div id="terminal-content">
            </div>
        </div>
    </div>

    <div class="mail-app" id="mail-app">
        <div class="mail-header">
            <div class="mail-header-left">
                <img src="mail.png" alt="Mail" class="mail-icon">
                <div class="mail-title">Inbox</div>
            </div>
            <div class="mail-header-right">
                <button class="close-button" onclick="closeMail()"></button>
            </div>
        </div>
        
        <div class="mail-content">
            <div class="update-list">
                <div class="update-item">
                    <div class="update-date">Available Now</div>
                    <div class="update-title">Gold Menu v1.1 Decompiled with Raw .ahk Macros</div>
                    <div class="update-content">
                        Full decompiled source with original AutoHotkey macros<br>
                        <em>Download: gold-menu-decompiled.zip</em>
                    </div>
                </div>
                <div class="update-item">
                    <div class="update-date">Available Now</div>
                    <div class="update-title">Akai Macro Whole Source Decompiled</div>
                    <div class="update-content">
                        Complete source code including all dependencies<br>
                        <em>Download: akai4.3-decompiled.zip</em>
                    </div>
                </div>
                <div class="update-item">
                    <div class="update-date">Available Now</div>
                    <div class="update-title">Akai Macro Patch (Crack)</div>
                    <div class="update-content">
                        Patched version of Akai4.3 with date restrictions removed<br>
                        <em>Download: akai4.3-patched.zip</em>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="finder-app" id="finder-app">
        <div class="finder-header">
            <div class="finder-header-left">
                <div class="finder-nav-buttons">
                    <button class="nav-button" id="back-button" onclick="goBack()" disabled>←</button>
                    <button class="nav-button" id="forward-button" onclick="goForward()" disabled>→</button>
                </div>
                <div class="finder-title">binwoken.sh</div>
            </div>
            <div class="finder-header-right">
                <button class="close-button" onclick="closeFinder()"></button>
            </div>
        </div>
        
        <div class="finder-content">
            <div class="finder-main">
                <div class="finder-grid">
                    <div class="finder-item" onclick="selectFinderItem('mervonz')" ondblclick="openFinderFolder('mervonz')">
                        <img src="Folder.webp" alt="Folder" class="finder-folder-icon">
                        <div class="finder-label">mervonz</div>
                    </div>
                    <div class="finder-item" onclick="selectFinderItem('vo1d')" ondblclick="openFinderFolder('vo1d')">
                        <img src="Folder.webp" alt="Folder" class="finder-folder-icon">
                        <div class="finder-label">vo1d</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="finder-status">
            <div class="status-text">2 items, 90.02 GB available</div>
        </div>
    </div>

    <div class="deepwoken-updates-app" id="deepwoken-updates-app">
        <div class="deepwoken-header">
            <div class="deepwoken-header-left">
                <img src="Deepwoken.png" alt="Deepwoken" class="deepwoken-icon">
                <div class="deepwoken-title">Deepwoken Updates</div>
            </div>
            <div class="deepwoken-header-right">
                <button class="close-button" onclick="closeDeepwokenUpdates()"></button>
            </div>
        </div>
        
        <div class="deepwoken-content" id="deepwoken-content">
            <div class="loading">Loading latest update...</div>
        </div>
    </div>

    <div class="text-editor" id="text-editor">
        <div class="text-editor-header">
            <div class="text-editor-header-left">
                <div class="text-editor-title">ClientAppSettings.json</div>
            </div>
            <div class="text-editor-header-right">
                <button class="close-button" onclick="closeTextEditor()"></button>
            </div>
        </div>
        
        <div class="text-editor-content">
            <pre id="file-content">Loading file...</pre>
        </div>
    </div>

    <script>
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let draggingWindow = null;
        
        // Separate offset tracking for each window
        let terminalOffset = { x: 0, y: 0 };
        let mailOffset = { x: 0, y: 0 };
        let finderOffset = { x: 0, y: 0 };
        let textEditorOffset = { x: 0, y: 0 };
        let deepwokenOffset = { x: 0, y: 0 };
        
        // Z-index management for window layering
        let currentZIndex = 1000;

        // Desktop selection variables
        let isSelecting = false;
        let selectionStartX = 0;
        let selectionStartY = 0;
        let selectedIcons = new Set();

        const terminal = document.querySelector('.terminal');
        const terminalContent = document.getElementById('terminal-content');
        let currentCommand = '';
        let commandHistory = [];
        let historyIndex = -1;
        let cursorPosition = 0;
        let availableCommands = ['download', 'ls', 'clear', 'whoami', 'date', 'echo', 'exit', 'help'];
        let availablePrograms = ['gold-menu', 'gold-menu-patcher', 'akai4.3', 'akai4.3-patched', 'gold-menu-decompiled', 'akai4.3-decompiled', 'astral_client', 'asphyxia_macro'];
        let currentMatches = [];
        let currentMatchIndex = 0;
        let randomAddress = Math.floor(Math.random() * (199 - 103 + 1)) + 103;

        // Dragging functionality
        terminal.addEventListener('mousedown', (e) => dragStart(e, 'terminal'));
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', dragEnd);

        // Mail app dragging functionality
        const mailApp = document.getElementById('mail-app');
        mailApp.addEventListener('mousedown', (e) => dragStart(e, 'mail'));

        // Finder app dragging functionality
        const finderApp = document.getElementById('finder-app');
        finderApp.addEventListener('mousedown', (e) => dragStart(e, 'finder'));

        // Text editor dragging functionality
        const textEditor = document.getElementById('text-editor');
        textEditor.addEventListener('mousedown', (e) => dragStart(e, 'text-editor'));

        // Deepwoken updates app dragging functionality
        const deepwokenApp = document.getElementById('deepwoken-updates-app');
        deepwokenApp.addEventListener('mousedown', (e) => dragStart(e, 'deepwoken'));

        function dragStart(e, windowType) {
            if (e.target.closest('.terminal-header') || e.target.closest('.mail-header') || e.target.closest('.finder-header') || e.target.closest('.text-editor-header') || e.target.closest('.deepwoken-header')) {
                // Use the appropriate offset for the window being dragged
                const offset = windowType === 'terminal' ? terminalOffset : 
                              windowType === 'mail' ? mailOffset : 
                              windowType === 'finder' ? finderOffset : 
                              windowType === 'deepwoken' ? deepwokenOffset : textEditorOffset;
                initialX = e.clientX - offset.x;
                initialY = e.clientY - offset.y;
                draggingWindow = windowType;
                isDragging = true;
                
                // Bring the dragged window to the front
                currentZIndex++;
                if (windowType === 'terminal') {
                    terminal.style.zIndex = currentZIndex;
                } else if (windowType === 'mail') {
                    mailApp.style.zIndex = currentZIndex;
                } else if (windowType === 'finder') {
                    finderApp.style.zIndex = currentZIndex;
                } else if (windowType === 'text-editor') {
                    textEditor.style.zIndex = currentZIndex;
                } else if (windowType === 'deepwoken') {
                    deepwokenApp.style.zIndex = currentZIndex;
                }
            }
        }

        function drag(e) {
            if (isDragging && draggingWindow) {
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;

                // Get window dimensions for boundary checking
                let windowElement, windowRect;
                if (draggingWindow === 'terminal' && terminal.style.display !== 'none') {
                    windowElement = terminal;
                    windowRect = terminal.getBoundingClientRect();
                } else if (draggingWindow === 'mail' && mailApp.style.display !== 'none') {
                    windowElement = mailApp;
                    windowRect = mailApp.getBoundingClientRect();
                } else if (draggingWindow === 'finder' && finderApp.style.display !== 'none') {
                    windowElement = finderApp;
                    windowRect = finderApp.getBoundingClientRect();
                } else if (draggingWindow === 'text-editor' && textEditor.style.display !== 'none') {
                    windowElement = textEditor;
                    windowRect = textEditor.getBoundingClientRect();
                } else if (draggingWindow === 'deepwoken' && deepwokenApp.style.display !== 'none') {
                    windowElement = deepwokenApp;
                    windowRect = deepwokenApp.getBoundingClientRect();
                } else {
                    return;
                }

                // Calculate boundaries
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                const windowWidth = windowRect.width;
                const windowHeight = windowRect.height;

                // Constrain X position (only right boundary, left can go off-screen)
                const maxX = viewportWidth - windowWidth;
                currentX = Math.min(maxX, currentX);

                // Constrain Y position (top and bottom boundaries)
                const minY = 0;
                const maxY = viewportHeight - windowHeight;
                currentY = Math.max(minY, Math.min(maxY, currentY));

                // Update the appropriate offset for the window being dragged
                if (draggingWindow === 'terminal') {
                    terminalOffset.x = currentX;
                    terminalOffset.y = currentY;
                    terminal.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
                if (draggingWindow === 'mail') {
                    mailOffset.x = currentX;
                    mailOffset.y = currentY;
                    mailApp.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
                if (draggingWindow === 'finder') {
                    finderOffset.x = currentX;
                    finderOffset.y = currentY;
                    finderApp.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
                if (draggingWindow === 'text-editor') {
                    textEditorOffset.x = currentX;
                    textEditorOffset.y = currentY;
                    textEditor.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
                if (draggingWindow === 'deepwoken') {
                    deepwokenOffset.x = currentX;
                    deepwokenOffset.y = currentY;
                    deepwokenApp.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
            }
        }

        function dragEnd(e) {
            // Update the appropriate offset for the window being dragged
            if (draggingWindow === 'terminal') {
                initialX = terminalOffset.x;
                initialY = terminalOffset.y;
            } else if (draggingWindow === 'mail') {
                initialX = mailOffset.x;
                initialY = mailOffset.y;
            } else if (draggingWindow === 'finder') {
                initialX = finderOffset.x;
                initialY = finderOffset.y;
            } else if (draggingWindow === 'text-editor') {
                initialX = textEditorOffset.x;
                initialY = textEditorOffset.y;
            } else if (draggingWindow === 'deepwoken') {
                initialX = deepwokenOffset.x;
                initialY = deepwokenOffset.y;
            }
            isDragging = false;
            draggingWindow = null;
        }

        // Terminal functionality
        function addLine(content, className = '') {
            const line = document.createElement('div');
            line.className = className;
            line.textContent = content;
            terminalContent.appendChild(line);
            terminalContent.scrollTop = terminalContent.scrollHeight;
        }

        function addOutput(output, className = 'output') {
            addLine(output, className);
        }

        function executeCommand(command) {
            commandHistory.push(command);
            historyIndex = commandHistory.length;

            switch (command.toLowerCase().trim()) {
                case 'help':
                    addOutput('  help - show all available commands');
                    addOutput('  ls - list programs');
                    addOutput('  clear - clear terminal');
                    addOutput('  whoami - show current user');
                    addOutput('  date - show current date');
                    addOutput('  echo <text> - echo text');
                    addOutput('  download <programname> - download a program');
                    addOutput('  exit - close terminal');
                    break;
                case 'ls':
                    addOutput('  gold-menu.exe --raphaelcsc911.github.io');
                    addOutput('  gold-menu-patcher.exe --bypass key system');
                    addOutput('  gold-menu-decompiled.zip --source code v1.1');
                    addOutput('  asphyxia_macro.zip --@_desov');
                    addOutput('  astral_client.zip --kintama macro');
                    addOutput('  akai4.3.exe --official, leaked by: @pendant');
                    addOutput('  akai4.3-patched.zip --bypass checks');
                    addOutput('  akai4.3-decompiled.zip --source code');
                    break;
                case 'clear':
                    terminalContent.innerHTML = '';
                    commandHistory = []; // Reset command history so help shows again
                    // Don't add prompt here - let the Enter key handler do it
                    return;
                case 'whoami':
                    addOutput('root');
                    break;
                case 'date':
                    addOutput(new Date().toString());
                    break;
                case 'exit':
                    closeTerminal();
                    return;
                default:
                    if (command.startsWith('download ')) {
                        let programName = command.substring(9).trim();
                        
                        // Auto-add extension if not present
                        if (!programName.endsWith('.exe') && !programName.endsWith('.zip')) {
                            // Check if it's a zip file by name
                            if (programName === 'gold-menu-decompiled') {
                                programName = programName + '.zip';
                            } else if (programName === 'akai4.3-decompiled') {
                                programName = programName + '.zip';
                            } else if (programName === 'astral_client') {
                                programName = programName + '.zip';
                            } else if (programName === 'asphyxia_macro') {
                                programName = programName + '.zip';
                            } else {
                                programName = programName + '.exe';
                            }
                        }
                        
                        if (programName === 'gold-menu.exe') {
                            addOutput('[INFO] Starting download of gold-menu...');
                            addOutput('[INFO] Connecting to GitHub repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'https://raphaelcsc911.github.io/GoldMenuSetup.exe';
                            link.download = 'gold-menu-setup.exe';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else if (programName === 'gold-menu-patcher.exe') {
                            addOutput('[INFO] Starting download of gold-menu-patcher...');
                            addOutput('[INFO] Connecting to GitHub repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'GoldMenu_Patcher.exe';
                            link.download = 'gold-menu-patcher.exe';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else if (programName === 'akai4.3.exe') {
                            addOutput('[INFO] Starting download of akai4.3...');
                            addOutput('[INFO] Connecting to GitHub repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'Officer.zip';
                            link.download = 'akai4.3.zip';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else if (programName === 'akai4.3-patched.exe') {
                            addOutput('[INFO] Starting download of akai4.3-patched...');
                            addOutput('[INFO] Connecting to GitHub repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'akai4.3-patched.zip';
                            link.download = 'akai4.3-patched.zip';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else if (programName === 'gold-menu-decompiled.zip') {
                            addOutput('[INFO] Starting download of gold-menu-decompiled.zip...');
                            addOutput('[INFO] Connecting to GitHub repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'gold_menu_decompiled.zip';
                            link.download = 'gold_menu_decompiled.zip';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else if (programName === 'akai4.3-decompiled.zip') {
                            addOutput('[INFO] Starting download of akai4.3-decompiled.zip...');
                            addOutput('[INFO] Connecting to GitHub repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'Officer-decompiled.zip';
                            link.download = 'Officer-decompiled.zip';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else if (programName === 'astral_client.zip') {
                            addOutput('[INFO] Opening Astral Client website...');
                            addOutput('[INFO] Redirecting to https://astralclient.cc...');
                            addOutput('[SUCCESS] Website opened in new tab!');
                            
                            // Open the website in a new tab
                            window.open('https://astralclient.cc', '_blank');
                        } else if (programName === 'asphyxia_macro.zip') {
                            addOutput('[INFO] Starting download of asphyxia_macro...');
                            addOutput('[INFO] Connecting to repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'asphyxia_macro.zip';
                            link.download = 'asphyxia_macro.zip';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else {
                            addOutput(`[ERROR] Program '${programName}' not found.`);
                        }
                    } else if (command.startsWith('echo ')) {
                        addOutput(command.substring(5));
                    } else {
                        addOutput(`Command not found: ${command}`);
                    }
            }
            // addNewPrompt() is now called manually in the Enter key handler
        }

        function addNewPrompt() {
            const promptLine = document.createElement('div');
            promptLine.className = 'prompt';
            promptLine.innerHTML = `root@0x${randomAddress.toString(16)}:~$ <span class="command"></span>`;
            terminalContent.appendChild(promptLine);
            terminalContent.scrollTop = terminalContent.scrollHeight;
            updateCurrentCommand(); // This will add the cursor
        }

        function showStartupHelp() {
            addOutput('  help - show all available commands', 'startup-help');
            addOutput('  ls - list programs', 'startup-help');
            addOutput('  clear - clear terminal', 'startup-help');
            addOutput('  whoami - show current user', 'startup-help');
            addOutput('  date - show current date', 'startup-help');
            addOutput('  echo <text> - echo text', 'startup-help');
            addOutput('  download <programname> - download a program', 'startup-help');
            addOutput('  exit - close terminal', 'startup-help');
        }

        function clearStartupHelp() {
            const startupHelpLines = terminalContent.querySelectorAll('.startup-help');
            startupHelpLines.forEach(line => {
                line.remove();
            });
        }

        function getAutocompleteSuggestion() {
            // Check if it's a download command with program name
            if (currentCommand.startsWith('download ')) {
                const programName = currentCommand.substring(9).trim();
                // Only show suggestions if there's at least one character typed
                if (programName.length > 0) {
                    const matches = availablePrograms.filter(prog => prog.startsWith(programName)).sort((a, b) => a.length - b.length);
                    if (matches.length > 0) {
                        return `download ${matches[currentMatchIndex % matches.length]}`;
                    }
                }
                return null;
            } else {
                // Regular command autocomplete
                const matches = availableCommands.filter(cmd => cmd.startsWith(currentCommand));
                return matches.length === 1 ? matches[0] : null;
            }
        }

        function updateMatches() {
            if (currentCommand.startsWith('download ')) {
                const programName = currentCommand.substring(9).trim();
                currentMatches = availablePrograms.filter(prog => prog.startsWith(programName)).sort((a, b) => a.length - b.length);
                currentMatchIndex = 0;
            } else {
                currentMatches = availableCommands.filter(cmd => cmd.startsWith(currentCommand));
                currentMatchIndex = 0;
            }
        }

        function updateCurrentCommand() {
            const lastPrompt = terminalContent.querySelector('.prompt:last-child');
            if (lastPrompt) {
                const commandSpan = lastPrompt.querySelector('.command');
                if (commandSpan) {
                    const suggestion = getAutocompleteSuggestion();
                    const beforeCursor = currentCommand.slice(0, cursorPosition);
                    const afterCursor = currentCommand.slice(cursorPosition);
                    
                    if (suggestion && suggestion !== currentCommand) {
                        const suggestionText = suggestion.substring(currentCommand.length);
                        commandSpan.innerHTML = beforeCursor + '<span class="cursor"></span>' + afterCursor + '<span class="suggestion">' + suggestionText + '</span>';
                    } else {
                        commandSpan.innerHTML = beforeCursor + '<span class="cursor"></span>' + afterCursor;
                    }
                }
            }
            
            // Only show help on very first prompt (empty command and no history)
            if (currentCommand === '' && commandHistory.length === 0) {
                showStartupHelp();
            }
        }

        // Keyboard input
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName === 'INPUT') return;

            if (e.key === 'Enter') {
                if (currentCommand.trim()) {
                    // Show the command that was entered
                    const lastPrompt = terminalContent.querySelector('.prompt:last-child');
                    if (lastPrompt) {
                        const commandSpan = lastPrompt.querySelector('.command');
                        if (commandSpan) {
                            commandSpan.textContent = currentCommand;
                        }
                        // Remove the cursor from this line
                        const cursor = lastPrompt.querySelector('.cursor');
                        if (cursor) {
                            cursor.remove();
                        }
                    }
                    
                    executeCommand(currentCommand);
                    currentCommand = '';
                    cursorPosition = 0;
                    addNewPrompt(); // Add new prompt after command execution
                }
            } else if (e.key === 'Backspace') {
                if (cursorPosition > 0) {
                    currentCommand = currentCommand.slice(0, cursorPosition - 1) + currentCommand.slice(cursorPosition);
                    cursorPosition--;
                    currentMatchIndex = 0; // Reset match index when deleting
                    updateCurrentCommand();
                }
            } else if (e.key === 'ArrowLeft') {
                if (cursorPosition > 0) {
                    cursorPosition--;
                    updateCurrentCommand();
                }
            } else if (e.key === 'ArrowRight') {
                if (cursorPosition < currentCommand.length) {
                    cursorPosition++;
                    updateCurrentCommand();
                }
            } else if (e.key === 'Tab') {
                e.preventDefault();
                updateMatches();
                
                if (currentCommand.startsWith('download ')) {
                    const programName = currentCommand.substring(9).trim();
                    // Only cycle if there's at least one character typed
                    if (programName.length > 0) {
                        const matches = availablePrograms.filter(prog => prog.startsWith(programName)).sort((a, b) => a.length - b.length);
                        
                        if (matches.length > 0) {
                            // Find matches that are longer than current program name
                            const longerMatches = matches.filter(prog => prog.length > programName.length);
                            
                            if (longerMatches.length > 0) {
                                // Cycle through longer matches only
                                const nextMatch = longerMatches[currentMatchIndex % longerMatches.length];
                                currentCommand = `download ${nextMatch}`;
                                cursorPosition = currentCommand.length;
                                currentMatchIndex++;
                                updateCurrentCommand();
                            }
                        }
                    }
                } else {
                    // Regular command autocomplete
                    const suggestion = getAutocompleteSuggestion();
                    if (suggestion) {
                        currentCommand = suggestion;
                        cursorPosition = currentCommand.length;
                        updateCurrentCommand();
                    }
                }
            } else if (e.key.length === 1) {
                // Clear startup help on first keystroke
                if (currentCommand === '') {
                    clearStartupHelp();
                }
                
                // Insert character at cursor position
                currentCommand = currentCommand.slice(0, cursorPosition) + e.key + currentCommand.slice(cursorPosition);
                cursorPosition++;
                currentMatchIndex = 0; // Reset match index when typing
                updateCurrentCommand();
            }
        });

        // Focus terminal on click
        terminal.addEventListener('click', function() {
            terminal.focus();
        });

        // Make terminal focusable
        terminal.setAttribute('tabindex', '0');
        terminal.focus();

        // Make mail app focusable
        mailApp.setAttribute('tabindex', '0');

        // Make finder app focusable
        finderApp.setAttribute('tabindex', '0');

        // Make text editor focusable
        textEditor.setAttribute('tabindex', '0');

        // Desktop icon functions
        function selectIcon(iconType) {
            // If multiple icons are selected, don't change selection on single click
            if (selectedIcons.size > 1) {
                return;
            }

            // Remove selection from all icons
            document.querySelectorAll('.desktop-icon').forEach(icon => {
                icon.classList.remove('selected', 'selected-multiple');
            });

            // Add selection to clicked icon
            const icon = document.getElementById(iconType + '-icon');
            icon.classList.add('selected');
            selectedIcons.clear();
            selectedIcons.add(icon.id);
        }

        function openTerminal() {
            const terminal = document.getElementById('terminal');
            terminal.style.display = 'block';
            terminal.focus();
            
            // Bring terminal to front
            currentZIndex++;
            terminal.style.zIndex = currentZIndex;
            
            // Only add prompt if terminal is empty (first time opening)
            if (terminalContent.children.length === 0) {
                addNewPrompt();
            }
        }

        function openMail() {
            const mailApp = document.getElementById('mail-app');
            mailApp.style.display = 'flex';
            mailApp.focus();
            
            // Bring mail app to front
            currentZIndex++;
            mailApp.style.zIndex = currentZIndex;
        }

        function closeMail() {
            const mailApp = document.getElementById('mail-app');
            mailApp.style.display = 'none';
        }

        function openDiscord() {
            window.open('https://discord.gg/RzGnytNDRR', '_blank');
        }

        function openFinder() {
            const finderApp = document.getElementById('finder-app');
            finderApp.style.display = 'flex';
            finderApp.focus();
            
            // Reset to root view and update navigation
            finderHistory = ['root'];
            currentHistoryIndex = 0;
            showFolderContents('root');
            updateNavButtons();
            
            // Bring finder app to front
            currentZIndex++;
            finderApp.style.zIndex = currentZIndex;
        }

        function openDeepwokenUpdates() {
            const deepwokenApp = document.getElementById('deepwoken-updates-app');
            deepwokenApp.style.display = 'flex';
            deepwokenApp.focus();
            
            // Bring deepwoken app to front
            currentZIndex++;
            deepwokenApp.style.zIndex = currentZIndex;
            
            // Load the latest update
            loadLatestUpdate();
        }

        function closeDeepwokenUpdates() {
            const deepwokenApp = document.getElementById('deepwoken-updates-app');
            deepwokenApp.style.display = 'none';
        }

        function loadLatestUpdate() {
            const contentDiv = document.getElementById('deepwoken-content');
            contentDiv.innerHTML = '<div class="loading">Loading latest update...</div>';
            
            const url = "https://deepwoken.fandom.com/wiki/Version_History/2025";
            const proxy = "https://api.allorigins.win/raw?url=";

            fetch(proxy + encodeURIComponent(url))
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, "text/html");

                    // Find h2 elements that contain dates
                    const h2Elements = doc.querySelectorAll('h2');
                    let latestDate = null;
                    let latestContent = null;

                    for (const h2 of h2Elements) {
                        const bElement = h2.querySelector('b');
                        if (bElement) {
                            const dateText = bElement.textContent.trim();
                            
                            // Check if this is a date like "August 18th, 2025"
                            if (/^[A-Za-z]+ \d{1,2}(st|nd|rd|th)?, \d{4}$/.test(dateText)) {
                                latestDate = dateText;
                                
                                // Find the next sibling div with mw-collapsible class
                                let nextSibling = h2.nextElementSibling;
                                while (nextSibling) {
                                    if (nextSibling.classList.contains('mw-collapsible')) {
                                        // Get the content and remove HTML tags
                                        latestContent = nextSibling.textContent.trim();
                                        break;
                                    }
                                    nextSibling = nextSibling.nextElementSibling;
                                }
                                break; // Stop after finding the first (latest) date
                            }
                        }
                    }

                    if (latestDate && latestContent) {
                        // Replace emojis with dots, handling cases where dot already exists
                        let formattedContent = latestContent;
                        
                        // First pass: handle emojis followed by dots (exclude numbers 0-9)
                        formattedContent = formattedContent.replace(/(?![0-9])\p{Emoji}\s*\./gu, '.');
                        
                        // Second pass: replace remaining emojis with dots (exclude numbers 0-9)
                        formattedContent = formattedContent.replace(/(?![0-9])\p{Emoji}/gu, '.');
                        
                        // Apply other formatting
                        formattedContent = formattedContent
                            .replace(/\n\n/g, '\n\n') // Preserve double line breaks
                            .replace(/\n/g, '\n') // Keep single line breaks
                            .replace(/\s+/g, ' ') // Normalize whitespace
                            .replace(/([.!?])\s*([A-Z])/g, '$1\n\n$2') // Add line breaks before new sentences
                            .replace(/\n\n([A-Z][^.\n]*?)\n/g, '\n\n=== $1 ===\n')
                            .trim();
                        
                        contentDiv.innerHTML = `
                            <div class="update-date">${latestDate}</div>
                            <div class="update-content">${formattedContent}</div>
                        `;
                    } else {
                        contentDiv.innerHTML = '<div class="error">Failed to load update information</div>';
                    }
                })
                .catch(err => {
                    console.error('Error loading update:', err);
                    contentDiv.innerHTML = '<div class="error">Error loading update information</div>';
                });
        }

        function closeFinder() {
            const finderApp = document.getElementById('finder-app');
            finderApp.style.display = 'none';
        }

        // Finder folder selection and interaction
        let selectedFinderItems = new Set();
        
        // Navigation history for back/forward buttons
        let finderHistory = ['root'];
        let currentHistoryIndex = 0;

        function selectFinderItem(folderName) {
            // Remove selection from all finder items
            document.querySelectorAll('.finder-item').forEach(item => {
                item.classList.remove('selected', 'selected-multiple');
            });

            // Add selection to clicked item
            const clickedItem = event.currentTarget;
            clickedItem.classList.add('selected');
            selectedFinderItems.clear();
            selectedFinderItems.add(folderName);
        }

        function openFinderFolder(folderName) {
            // Add to history
            finderHistory = finderHistory.slice(0, currentHistoryIndex + 1);
            finderHistory.push(folderName);
            currentHistoryIndex = finderHistory.length - 1;
            
            // Show folder contents
            showFolderContents(folderName);
            updateNavButtons();
        }

        function goBack() {
            if (currentHistoryIndex > 0) {
                currentHistoryIndex--;
                const folderName = finderHistory[currentHistoryIndex];
                showFolderContents(folderName);
                updateNavButtons();
            }
        }

        function goForward() {
            if (currentHistoryIndex < finderHistory.length - 1) {
                currentHistoryIndex++;
                const folderName = finderHistory[currentHistoryIndex];
                showFolderContents(folderName);
                updateNavButtons();
            }
        }

        function updateNavButtons() {
            const backButton = document.getElementById('back-button');
            const forwardButton = document.getElementById('forward-button');
            
            backButton.disabled = currentHistoryIndex <= 0;
            forwardButton.disabled = currentHistoryIndex >= finderHistory.length - 1;
        }

        function showFolderContents(folderName) {
            const finderGrid = document.querySelector('.finder-grid');
            const finderTitle = document.querySelector('.finder-title');
            
            if (folderName === 'root') {
                finderTitle.textContent = 'binwoken.sh';
                finderGrid.innerHTML = `
                    <div class="finder-item" onclick="selectFinderItem('mervonz')" ondblclick="openFinderFolder('mervonz')">
                        <img src="Folder.webp" alt="Folder" class="finder-folder-icon">
                        <div class="finder-label">mervonz</div>
                    </div>
                `;
            } else if (folderName === 'mervonz') {
                finderTitle.textContent = 'mervonz';
                finderGrid.innerHTML = `
                    <div class="finder-item" onclick="selectFinderItem('ClientAppSettings.json')" ondblclick="openFile('ClientAppSettings.json')" oncontextmenu="showContextMenu(event, 'ClientAppSettings.json')">
                        <div class="finder-file-icon">📄</div>
                        <div class="finder-label">ClientAppSettings.json</div>
                    </div>
                `;
            }
        }

        function openFile(fileName) {
            if (fileName === 'ClientAppSettings.json') {
                openTextEditor(fileName);
            }
        }

        function openTextEditor(fileName) {
            const textEditor = document.getElementById('text-editor');
            const title = document.querySelector('.text-editor-title');
            const content = document.getElementById('file-content');
            
            title.textContent = fileName;
            
            // Load the actual file content
            if (fileName === 'ClientAppSettings.json') {
                fetch('ClientAppSettings.json')
                    .then(response => response.text())
                    .then(data => {
                        content.innerHTML = '<span style="color: #666; font-style: italic;">credits: @reddice</span>\n\n' + data;
                    })
                    .catch(error => {
                        content.textContent = 'Error loading file: ' + error.message;
                    });
            }
            
            textEditor.style.display = 'flex';
            textEditor.focus();
            
            // Bring text editor to front
            currentZIndex++;
            textEditor.style.zIndex = currentZIndex;
        }

        function closeTextEditor() {
            const textEditor = document.getElementById('text-editor');
            textEditor.style.display = 'none';
        }

        function showContextMenu(event, fileName) {
            event.preventDefault();
            
            // Remove any existing context menu
            const existingMenu = document.querySelector('.context-menu');
            if (existingMenu) {
                existingMenu.remove();
            }
            
            // Create context menu
            const contextMenu = document.createElement('div');
            contextMenu.className = 'context-menu';
            contextMenu.style.position = 'fixed';
            contextMenu.style.left = event.clientX + 'px';
            contextMenu.style.top = event.clientY + 'px';
            contextMenu.style.zIndex = '20000';
            contextMenu.innerHTML = `
                <div class="context-item" onclick="openFile('${fileName}'); hideContextMenu();">Open</div>
                <div class="context-item" onclick="downloadFile('${fileName}'); hideContextMenu();">Download</div>
            `;
            
            document.body.appendChild(contextMenu);
            
            // Hide context menu when clicking elsewhere
            setTimeout(() => {
                document.addEventListener('click', hideContextMenu, { once: true });
            }, 0);
        }

        function hideContextMenu() {
            const contextMenu = document.querySelector('.context-menu');
            if (contextMenu) {
                contextMenu.remove();
            }
        }

        function downloadFile(fileName) {
            if (fileName === 'ClientAppSettings.json') {
                // Create and trigger download
                const link = document.createElement('a');
                link.href = 'ClientAppSettings.json';
                link.download = 'ClientAppSettings.json';
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // Close terminal function
        function closeTerminal() {
            const terminal = document.getElementById('terminal');
            terminal.style.display = 'none';
        }

        // Desktop selection functionality
        document.addEventListener('mousedown', function(e) {
            // Only start selection if clicking on empty desktop area or finder main area
            if (e.target === document.body || e.target.classList.contains('selection-box') || 
                e.target.classList.contains('finder-main') || e.target.classList.contains('finder-grid')) {
                e.preventDefault();
                isSelecting = true;
                selectionStartX = e.clientX;
                selectionStartY = e.clientY;
                
                // Add no-select class to body to prevent text selection
                document.body.classList.add('no-select');
                
                const selectionBox = document.getElementById('selection-box');
                selectionBox.style.left = selectionStartX + 'px';
                selectionBox.style.top = selectionStartY + 'px';
                selectionBox.style.width = '0px';
                selectionBox.style.height = '0px';
                selectionBox.style.display = 'block';
                
                // Clear previous selections
                selectedIcons.clear();
                selectedFinderItems.clear();
                document.querySelectorAll('.desktop-icon').forEach(icon => {
                    icon.classList.remove('selected', 'selected-multiple');
                });
                document.querySelectorAll('.finder-item').forEach(item => {
                    item.classList.remove('selected', 'selected-multiple');
                });
            }
        });

        document.addEventListener('mousemove', function(e) {
            if (isSelecting) {
                e.preventDefault();
                const selectionBox = document.getElementById('selection-box');
                const currentX = e.clientX;
                const currentY = e.clientY;
                
                const left = Math.min(selectionStartX, currentX);
                const top = Math.min(selectionStartY, currentY);
                const width = Math.abs(currentX - selectionStartX);
                const height = Math.abs(currentY - selectionStartY);
                
                selectionBox.style.left = left + 'px';
                selectionBox.style.top = top + 'px';
                selectionBox.style.width = width + 'px';
                selectionBox.style.height = height + 'px';
                
                // Check which icons are in selection
                document.querySelectorAll('.desktop-icon').forEach(icon => {
                    const rect = icon.getBoundingClientRect();
                    const iconLeft = rect.left;
                    const iconTop = rect.top;
                    const iconRight = rect.right;
                    const iconBottom = rect.bottom;
                    
                    if (left < iconRight && left + width > iconLeft && 
                        top < iconBottom && top + height > iconTop) {
                        if (!selectedIcons.has(icon.id)) {
                            selectedIcons.add(icon.id);
                            icon.classList.add('selected-multiple');
                        }
                    } else {
                        if (selectedIcons.has(icon.id)) {
                            selectedIcons.delete(icon.id);
                            icon.classList.remove('selected-multiple');
                        }
                    }
                });

                // Check which finder items are in selection
                document.querySelectorAll('.finder-item').forEach(item => {
                    const rect = item.getBoundingClientRect();
                    const itemLeft = rect.left;
                    const itemTop = rect.top;
                    const itemRight = rect.right;
                    const itemBottom = rect.bottom;
                    
                    if (left < itemRight && left + width > itemLeft && 
                        top < itemBottom && top + height > itemTop) {
                        if (!selectedFinderItems.has(item.querySelector('.finder-label').textContent)) {
                            selectedFinderItems.add(item.querySelector('.finder-label').textContent);
                            item.classList.add('selected-multiple');
                        }
                    } else {
                        const itemName = item.querySelector('.finder-label').textContent;
                        if (selectedFinderItems.has(itemName)) {
                            selectedFinderItems.delete(itemName);
                            item.classList.remove('selected-multiple');
                        }
                    }
                });
            }
        });

        document.addEventListener('mouseup', function(e) {
            if (isSelecting) {
                e.preventDefault();
                isSelecting = false;
                const selectionBox = document.getElementById('selection-box');
                selectionBox.style.display = 'none';
                
                // Remove no-select class from body
                document.body.classList.remove('no-select');
                
                // Don't auto-open selected icons - user needs to click/double-click them
            }
        });

        // Click outside to deselect icons
        document.addEventListener('click', function(e) {
            const terminalIcon = document.getElementById('terminal-icon');
            const mailIcon = document.getElementById('mail-icon');
            const discordIcon = document.getElementById('discord-icon');
            const finderIcon = document.getElementById('finder-icon');
            const deepwokenIcon = document.getElementById('deepwoken-icon');
            const terminal = document.getElementById('terminal');
            const mailApp = document.getElementById('mail-app');
            const finderApp = document.getElementById('finder-app');
            const deepwokenApp = document.getElementById('deepwoken-updates-app');
            
            if (!terminalIcon.contains(e.target) && !mailIcon.contains(e.target) && !discordIcon.contains(e.target) && !finderIcon.contains(e.target) && !deepwokenIcon.contains(e.target) && !terminal.contains(e.target) && !mailApp.contains(e.target) && !finderApp.contains(e.target) && !deepwokenApp.contains(e.target)) {
                // Clear all selections
                terminalIcon.classList.remove('selected', 'selected-multiple');
                mailIcon.classList.remove('selected', 'selected-multiple');
                discordIcon.classList.remove('selected', 'selected-multiple');
                finderIcon.classList.remove('selected', 'selected-multiple');
                deepwokenIcon.classList.remove('selected', 'selected-multiple');
                selectedIcons.clear();
            }
        });

        // Initialize
        addNewPrompt();
    </script>
</body>
</html>
