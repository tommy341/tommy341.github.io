<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>workspace</title>
    
    <!-- Open Graph Meta Tags for Discord/Twitter/Facebook embeds -->
    <meta property="og:title" content="workspace">
    <meta property="og:description" content="A comprehensive collection of Deepwoken software. Everything you need in one place.">
    <meta property="og:image" content="https://tommy341.github.io/terminal.webp">
    <meta property="og:url" content="https://tommy341.github.io">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="workspace">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="workspace">
    <meta name="twitter:description" content="A comprehensive collection of Deepwoken software. Everything you need in one place.">
    <meta name="twitter:image" content="https://tommy341.github.io/terminal.webp">
    
    <!-- Additional Meta Tags -->
    <meta name="description" content="A comprehensive collection of Deepwoken software. Everything you need in one place.">
    <meta name="keywords" content="terminal, desktop, applications, deepwoken, software, collection">
    <meta name="author" content="workspace">
    
    <link rel="icon" type="image/webp" href="terminal.webp">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000000;
            color: #cccccc;
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            min-height: 100vh;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        .terminal {
            width: 50vw;
            height: 60vh;
            position: absolute;
            top: 50px;
            left: calc(50vw - 25vw);
            min-width: 600px;
            min-height: 500px;
            outline: none;
            display: none;
        }

        .desktop-icon {
            position: absolute;
            top: 35%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
            user-select: none;
            width: 120px;
            height: 135px;
        }

        #terminal-icon {
            left: 25%;
        }

        #mail-icon {
            left: 34%;
        }

        #discord-icon {
            left: 43%;
        }

        .desktop-icon:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .desktop-icon.selected {
            background-color: rgba(0, 123, 255, 0.3);
        }

        .desktop-icon img {
            width: 80px;
            height: 80px;
            margin-bottom: 8px;
        }

        .desktop-icon-text {
            color: #ffffff;
            font-size: 14px;
            text-align: center;
            white-space: nowrap;
        }

        .terminal-header {
            background: #1a1a1a;
            padding: 10px 15px;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: move;
            user-select: none;
        }

        .terminal-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .terminal-header-right {
            display: flex;
            align-items: center;
        }

        .terminal-icon {
            width: 32px;
            height: 32px;
            flex-shrink: 0;
        }

        .close-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff5f57;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: background-color 0.2s ease;
        }

        .close-button:hover {
            background: #ff3b30;
        }

        .close-button::before {
            content: 'Ã—';
            color: #000;
            font-size: 10px;
            font-weight: bold;
            line-height: 1;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .close-button:hover::before {
            opacity: 1;
        }

        .terminal-dots {
            display: flex;
            gap: 6px;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot.red { background: #cc0000; }
        .dot.yellow { background: #cc9900; }
        .dot.green { background: #00cc00; }

        .terminal-title {
            color: #888888;
            font-size: 12px;
        }

        .terminal-body {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 0 0 8px 8px;
            height: calc(100% - 50px);
            overflow-y: auto;
        }

        .prompt {
            color: #ffffff;
            font-weight: 600;
        }

        .command {
            color: #cccccc;
        }

        .output {
            color: #888888;
            margin-left: 20px;
        }

        .cursor {
            display: inline-block;
            width: 8px;
            height: 4px;
            background: #cccccc;
            animation: blink 1s infinite;
            vertical-align: baseline;
            margin-left: 0;
            margin-right: -8px;
            transform: translateY(6px);
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .help-text {
            color: #666666;
            margin: 20px 0;
        }

        .help-command {
            color: #cc9900;
            font-weight: 600;
        }

        .suggestion {
            color: #666666;
            opacity: 0.7;
        }

        /* Mail App Styles - Minimal Update Logs */
        .mail-app {
            width: 60vw;
            height: 70vh;
            position: absolute;
            top: 15vh;
            left: 20vw;
            min-width: 600px;
            min-height: 400px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            overflow: hidden;
            outline: none;
        }

        .mail-header {
            background: #f8f8f8;
            padding: 12px 20px;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e0e0e0;
            cursor: move;
            user-select: none;
        }

        .mail-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mail-header-right {
            display: flex;
            align-items: center;
        }

        .mail-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .mail-title {
            color: #333333;
            font-size: 16px;
            font-weight: 600;
            line-height: 1;
        }

        .mail-content {
            flex: 1;
            overflow-y: auto;
            background: white;
        }

        .update-list {
            padding: 20px;
        }

        .update-item {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .update-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .update-date {
            color: #666;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .update-title {
            color: #333;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .update-content {
            color: #555;
            font-size: 14px;
            line-height: 1.6;
        }

        /* Desktop selection box */
        .selection-box {
            position: absolute;
            border: 2px dashed #007AFF;
            background: rgba(0, 122, 255, 0.1);
            pointer-events: none;
            z-index: 1000;
            display: none;
        }

        .desktop-icon.selected-multiple {
            background-color: rgba(0, 123, 255, 0.5);
        }
    </style>
</head>
<body>
    <div class="desktop-icon" id="terminal-icon" onclick="selectIcon('terminal')" ondblclick="openTerminal()">
        <img src="terminal.webp" alt="Terminal">
        <div class="desktop-icon-text">terminal.exe</div>
    </div>

    <div class="desktop-icon" id="mail-icon" onclick="selectIcon('mail')" ondblclick="openMail()">
        <img src="mail.png" alt="Mail">
        <div class="desktop-icon-text">mail.exe</div>
    </div>

    <div class="desktop-icon" id="discord-icon" onclick="selectIcon('discord')" ondblclick="openDiscord()">
        <img src="discord.png" alt="Discord">
        <div class="desktop-icon-text">discord.exe</div>
    </div>

    <div class="selection-box" id="selection-box"></div>

    <div class="terminal" id="terminal">
        <div class="terminal-header">
            <div class="terminal-header-left">
                <img src="terminal.webp" alt="Terminal" class="terminal-icon">
                <div class="terminal-title">terminal.exe</div>
            </div>
            <div class="terminal-header-right">
                <button class="close-button" onclick="closeTerminal()"></button>
            </div>
        </div>
        
        <div class="terminal-body">
            <div id="terminal-content">
            </div>
        </div>
    </div>

    <div class="mail-app" id="mail-app">
        <div class="mail-header">
            <div class="mail-header-left">
                <img src="mail.png" alt="Mail" class="mail-icon">
                <div class="mail-title">Inbox</div>
            </div>
            <div class="mail-header-right">
                <button class="close-button" onclick="closeMail()"></button>
            </div>
        </div>
        
        <div class="mail-content">
            <div class="update-list">
                <div class="update-item">
                    <div class="update-date">Available Now</div>
                    <div class="update-title">Gold Menu v1.1 Decompiled with Raw .ahk Macros</div>
                    <div class="update-content">
                        Full decompiled source with original AutoHotkey macros<br>
                        <em>Download: gold-menu-decompiled.zip</em>
                    </div>
                </div>
                <div class="update-item">
                    <div class="update-date">Available Now</div>
                    <div class="update-title">Akai Macro Whole Source Decompiled</div>
                    <div class="update-content">
                        Complete source code including all dependencies<br>
                        <em>Download: akai4.3-decompiled.zip</em>
                    </div>
                </div>
                <div class="update-item">
                    <div class="update-date">Available Now</div>
                    <div class="update-title">Akai Macro Patch (Crack)</div>
                    <div class="update-content">
                        Patched version of Akai4.3 with date restrictions removed<br>
                        <em>Download: akai4.3-patched.zip</em>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let draggingWindow = null;
        
        // Separate offset tracking for each window
        let terminalOffset = { x: 0, y: 0 };
        let mailOffset = { x: 0, y: 0 };
        
        // Z-index management for window layering
        let currentZIndex = 1000;

        // Desktop selection variables
        let isSelecting = false;
        let selectionStartX = 0;
        let selectionStartY = 0;
        let selectedIcons = new Set();

        const terminal = document.querySelector('.terminal');
        const terminalContent = document.getElementById('terminal-content');
        let currentCommand = '';
        let commandHistory = [];
        let historyIndex = -1;
        let cursorPosition = 0;
        let availableCommands = ['download', 'ls', 'clear', 'whoami', 'date', 'echo', 'exit', 'help'];
        let availablePrograms = ['gold-menu', 'gold-menu-patcher', 'akai4.3', 'akai4.3-patched', 'gold-menu-decompiled', 'akai4.3-decompiled', 'astral_client', 'asphyxia_macro'];
        let currentMatches = [];
        let currentMatchIndex = 0;
        let randomAddress = Math.floor(Math.random() * (199 - 103 + 1)) + 103;

        // Dragging functionality
        terminal.addEventListener('mousedown', (e) => dragStart(e, 'terminal'));
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', dragEnd);

        // Mail app dragging functionality
        const mailApp = document.getElementById('mail-app');
        mailApp.addEventListener('mousedown', (e) => dragStart(e, 'mail'));

        function dragStart(e, windowType) {
            if (e.target.closest('.terminal-header') || e.target.closest('.mail-header')) {
                // Use the appropriate offset for the window being dragged
                const offset = windowType === 'terminal' ? terminalOffset : mailOffset;
                initialX = e.clientX - offset.x;
                initialY = e.clientY - offset.y;
                draggingWindow = windowType;
                isDragging = true;
                
                // Bring the dragged window to the front
                currentZIndex++;
                if (windowType === 'terminal') {
                    terminal.style.zIndex = currentZIndex;
                } else if (windowType === 'mail') {
                    mailApp.style.zIndex = currentZIndex;
                }
            }
        }

        function drag(e) {
            if (isDragging && draggingWindow) {
                e.preventDefault();
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;

                // Get window dimensions for boundary checking
                let windowElement, windowRect;
                if (draggingWindow === 'terminal' && terminal.style.display !== 'none') {
                    windowElement = terminal;
                    windowRect = terminal.getBoundingClientRect();
                } else if (draggingWindow === 'mail' && mailApp.style.display !== 'none') {
                    windowElement = mailApp;
                    windowRect = mailApp.getBoundingClientRect();
                } else {
                    return;
                }

                // Calculate boundaries
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                const windowWidth = windowRect.width;
                const windowHeight = windowRect.height;

                // Constrain X position (only right boundary, left can go off-screen)
                const maxX = viewportWidth - windowWidth;
                currentX = Math.min(maxX, currentX);

                // Constrain Y position (top and bottom boundaries)
                const minY = 0;
                const maxY = viewportHeight - windowHeight;
                currentY = Math.max(minY, Math.min(maxY, currentY));

                // Update the appropriate offset for the window being dragged
                if (draggingWindow === 'terminal') {
                    terminalOffset.x = currentX;
                    terminalOffset.y = currentY;
                    terminal.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
                if (draggingWindow === 'mail') {
                    mailOffset.x = currentX;
                    mailOffset.y = currentY;
                    mailApp.style.transform = `translate(${currentX}px, ${currentY}px)`;
                }
            }
        }

        function dragEnd(e) {
            // Update the appropriate offset for the window being dragged
            if (draggingWindow === 'terminal') {
                initialX = terminalOffset.x;
                initialY = terminalOffset.y;
            } else if (draggingWindow === 'mail') {
                initialX = mailOffset.x;
                initialY = mailOffset.y;
            }
            isDragging = false;
            draggingWindow = null;
        }

        // Terminal functionality
        function addLine(content, className = '') {
            const line = document.createElement('div');
            line.className = className;
            line.textContent = content;
            terminalContent.appendChild(line);
            terminalContent.scrollTop = terminalContent.scrollHeight;
        }

        function addOutput(output, className = 'output') {
            addLine(output, className);
        }

        function executeCommand(command) {
            commandHistory.push(command);
            historyIndex = commandHistory.length;

            switch (command.toLowerCase().trim()) {
                case 'help':
                    addOutput('  help - show all available commands');
                    addOutput('  ls - list programs');
                    addOutput('  clear - clear terminal');
                    addOutput('  whoami - show current user');
                    addOutput('  date - show current date');
                    addOutput('  echo <text> - echo text');
                    addOutput('  download <programname> - download a program');
                    addOutput('  exit - close terminal');
                    break;
                case 'ls':
                    addOutput('  gold-menu.exe --raphaelcsc911.github.io');
                    addOutput('  gold-menu-patcher.exe --bypass key system');
                    addOutput('  gold-menu-decompiled.zip --source code v1.1');
                    addOutput('  asphyxia_macro.zip --@_desov');
                    addOutput('  astral_client.zip --kintama macro');
                    addOutput('  akai4.3.exe --official, leaked by: @pendant');
                    addOutput('  akai4.3-patched.zip --bypass checks');
                    addOutput('  akai4.3-decompiled.zip --source code');
                    break;
                case 'clear':
                    terminalContent.innerHTML = '';
                    commandHistory = []; // Reset command history so help shows again
                    // Don't add prompt here - let the Enter key handler do it
                    return;
                case 'whoami':
                    addOutput('root');
                    break;
                case 'date':
                    addOutput(new Date().toString());
                    break;
                case 'exit':
                    closeTerminal();
                    return;
                default:
                    if (command.startsWith('download ')) {
                        let programName = command.substring(9).trim();
                        
                        // Auto-add extension if not present
                        if (!programName.endsWith('.exe') && !programName.endsWith('.zip')) {
                            // Check if it's a zip file by name
                            if (programName === 'gold-menu-decompiled') {
                                programName = programName + '.zip';
                            } else if (programName === 'akai4.3-decompiled') {
                                programName = programName + '.zip';
                            } else if (programName === 'astral_client') {
                                programName = programName + '.zip';
                            } else if (programName === 'asphyxia_macro') {
                                programName = programName + '.zip';
                            } else {
                                programName = programName + '.exe';
                            }
                        }
                        
                        if (programName === 'gold-menu.exe') {
                            addOutput('[INFO] Starting download of gold-menu...');
                            addOutput('[INFO] Connecting to GitHub repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'https://raphaelcsc911.github.io/GoldMenuSetup.exe';
                            link.download = 'gold-menu-setup.exe';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else if (programName === 'gold-menu-patcher.exe') {
                            addOutput('[INFO] Starting download of gold-menu-patcher...');
                            addOutput('[INFO] Connecting to GitHub repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'GoldMenu_Patcher.exe';
                            link.download = 'gold-menu-patcher.exe';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else if (programName === 'akai4.3.exe') {
                            addOutput('[INFO] Starting download of akai4.3...');
                            addOutput('[INFO] Connecting to GitHub repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'Officer.zip';
                            link.download = 'akai4.3.zip';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else if (programName === 'akai4.3-patched.exe') {
                            addOutput('[INFO] Starting download of akai4.3-patched...');
                            addOutput('[INFO] Connecting to GitHub repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'akai4.3-patched.zip';
                            link.download = 'akai4.3-patched.zip';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else if (programName === 'gold-menu-decompiled.zip') {
                            addOutput('[INFO] Starting download of gold-menu-decompiled.zip...');
                            addOutput('[INFO] Connecting to GitHub repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'gold_menu_decompiled.zip';
                            link.download = 'gold_menu_decompiled.zip';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else if (programName === 'akai4.3-decompiled.zip') {
                            addOutput('[INFO] Starting download of akai4.3-decompiled.zip...');
                            addOutput('[INFO] Connecting to GitHub repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'Officer-decompiled.zip';
                            link.download = 'Officer-decompiled.zip';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else if (programName === 'astral_client.zip') {
                            addOutput('[INFO] Opening Astral Client website...');
                            addOutput('[INFO] Redirecting to https://astralclient.cc...');
                            addOutput('[SUCCESS] Website opened in new tab!');
                            
                            // Open the website in a new tab
                            window.open('https://astralclient.cc', '_blank');
                        } else if (programName === 'asphyxia_macro.zip') {
                            addOutput('[INFO] Starting download of asphyxia_macro...');
                            addOutput('[INFO] Connecting to repository...');
                            addOutput('[SUCCESS] Download started!');
                            
                            // Actually trigger the download
                            const link = document.createElement('a');
                            link.href = 'asphyxia_macro.zip';
                            link.download = 'asphyxia_macro.zip';
                            link.style.display = 'none';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        } else {
                            addOutput(`[ERROR] Program '${programName}' not found.`);
                        }
                    } else if (command.startsWith('echo ')) {
                        addOutput(command.substring(5));
                    } else {
                        addOutput(`Command not found: ${command}`);
                    }
            }
            // addNewPrompt() is now called manually in the Enter key handler
        }

        function addNewPrompt() {
            const promptLine = document.createElement('div');
            promptLine.className = 'prompt';
            promptLine.innerHTML = `root@0x${randomAddress.toString(16)}:~$ <span class="command"></span>`;
            terminalContent.appendChild(promptLine);
            terminalContent.scrollTop = terminalContent.scrollHeight;
            updateCurrentCommand(); // This will add the cursor
        }

        function showStartupHelp() {
            addOutput('  help - show all available commands', 'startup-help');
            addOutput('  ls - list programs', 'startup-help');
            addOutput('  clear - clear terminal', 'startup-help');
            addOutput('  whoami - show current user', 'startup-help');
            addOutput('  date - show current date', 'startup-help');
            addOutput('  echo <text> - echo text', 'startup-help');
            addOutput('  download <programname> - download a program', 'startup-help');
            addOutput('  exit - close terminal', 'startup-help');
        }

        function clearStartupHelp() {
            const startupHelpLines = terminalContent.querySelectorAll('.startup-help');
            startupHelpLines.forEach(line => {
                line.remove();
            });
        }

        function getAutocompleteSuggestion() {
            // Check if it's a download command with program name
            if (currentCommand.startsWith('download ')) {
                const programName = currentCommand.substring(9).trim();
                // Only show suggestions if there's at least one character typed
                if (programName.length > 0) {
                    const matches = availablePrograms.filter(prog => prog.startsWith(programName)).sort((a, b) => a.length - b.length);
                    if (matches.length > 0) {
                        return `download ${matches[currentMatchIndex % matches.length]}`;
                    }
                }
                return null;
            } else {
                // Regular command autocomplete
                const matches = availableCommands.filter(cmd => cmd.startsWith(currentCommand));
                return matches.length === 1 ? matches[0] : null;
            }
        }

        function updateMatches() {
            if (currentCommand.startsWith('download ')) {
                const programName = currentCommand.substring(9).trim();
                currentMatches = availablePrograms.filter(prog => prog.startsWith(programName)).sort((a, b) => a.length - b.length);
                currentMatchIndex = 0;
            } else {
                currentMatches = availableCommands.filter(cmd => cmd.startsWith(currentCommand));
                currentMatchIndex = 0;
            }
        }

        function updateCurrentCommand() {
            const lastPrompt = terminalContent.querySelector('.prompt:last-child');
            if (lastPrompt) {
                const commandSpan = lastPrompt.querySelector('.command');
                if (commandSpan) {
                    const suggestion = getAutocompleteSuggestion();
                    const beforeCursor = currentCommand.slice(0, cursorPosition);
                    const afterCursor = currentCommand.slice(cursorPosition);
                    
                    if (suggestion && suggestion !== currentCommand) {
                        const suggestionText = suggestion.substring(currentCommand.length);
                        commandSpan.innerHTML = beforeCursor + '<span class="cursor"></span>' + afterCursor + '<span class="suggestion">' + suggestionText + '</span>';
                    } else {
                        commandSpan.innerHTML = beforeCursor + '<span class="cursor"></span>' + afterCursor;
                    }
                }
            }
            
            // Only show help on very first prompt (empty command and no history)
            if (currentCommand === '' && commandHistory.length === 0) {
                showStartupHelp();
            }
        }

        // Keyboard input
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName === 'INPUT') return;

            if (e.key === 'Enter') {
                if (currentCommand.trim()) {
                    // Show the command that was entered
                    const lastPrompt = terminalContent.querySelector('.prompt:last-child');
                    if (lastPrompt) {
                        const commandSpan = lastPrompt.querySelector('.command');
                        if (commandSpan) {
                            commandSpan.textContent = currentCommand;
                        }
                        // Remove the cursor from this line
                        const cursor = lastPrompt.querySelector('.cursor');
                        if (cursor) {
                            cursor.remove();
                        }
                    }
                    
                    executeCommand(currentCommand);
                    currentCommand = '';
                    cursorPosition = 0;
                    addNewPrompt(); // Add new prompt after command execution
                }
            } else if (e.key === 'Backspace') {
                if (cursorPosition > 0) {
                    currentCommand = currentCommand.slice(0, cursorPosition - 1) + currentCommand.slice(cursorPosition);
                    cursorPosition--;
                    currentMatchIndex = 0; // Reset match index when deleting
                    updateCurrentCommand();
                }
            } else if (e.key === 'ArrowLeft') {
                if (cursorPosition > 0) {
                    cursorPosition--;
                    updateCurrentCommand();
                }
            } else if (e.key === 'ArrowRight') {
                if (cursorPosition < currentCommand.length) {
                    cursorPosition++;
                    updateCurrentCommand();
                }
            } else if (e.key === 'Tab') {
                e.preventDefault();
                updateMatches();
                
                if (currentCommand.startsWith('download ')) {
                    const programName = currentCommand.substring(9).trim();
                    // Only cycle if there's at least one character typed
                    if (programName.length > 0) {
                        const matches = availablePrograms.filter(prog => prog.startsWith(programName)).sort((a, b) => a.length - b.length);
                        
                        if (matches.length > 0) {
                            // Find matches that are longer than current program name
                            const longerMatches = matches.filter(prog => prog.length > programName.length);
                            
                            if (longerMatches.length > 0) {
                                // Cycle through longer matches only
                                const nextMatch = longerMatches[currentMatchIndex % longerMatches.length];
                                currentCommand = `download ${nextMatch}`;
                                cursorPosition = currentCommand.length;
                                currentMatchIndex++;
                                updateCurrentCommand();
                            }
                        }
                    }
                } else {
                    // Regular command autocomplete
                    const suggestion = getAutocompleteSuggestion();
                    if (suggestion) {
                        currentCommand = suggestion;
                        cursorPosition = currentCommand.length;
                        updateCurrentCommand();
                    }
                }
            } else if (e.key.length === 1) {
                // Clear startup help on first keystroke
                if (currentCommand === '') {
                    clearStartupHelp();
                }
                
                // Insert character at cursor position
                currentCommand = currentCommand.slice(0, cursorPosition) + e.key + currentCommand.slice(cursorPosition);
                cursorPosition++;
                currentMatchIndex = 0; // Reset match index when typing
                updateCurrentCommand();
            }
        });

        // Focus terminal on click
        terminal.addEventListener('click', function() {
            terminal.focus();
        });

        // Make terminal focusable
        terminal.setAttribute('tabindex', '0');
        terminal.focus();

        // Make mail app focusable
        mailApp.setAttribute('tabindex', '0');

        // Desktop icon functions
        function selectIcon(iconType) {
            // If multiple icons are selected, don't change selection on single click
            if (selectedIcons.size > 1) {
                return;
            }

            // Remove selection from all icons
            document.querySelectorAll('.desktop-icon').forEach(icon => {
                icon.classList.remove('selected', 'selected-multiple');
            });

            // Add selection to clicked icon
            const icon = document.getElementById(iconType + '-icon');
            icon.classList.add('selected');
            selectedIcons.clear();
            selectedIcons.add(icon.id);
        }

        function openTerminal() {
            const terminal = document.getElementById('terminal');
            terminal.style.display = 'block';
            terminal.focus();
            
            // Bring terminal to front
            currentZIndex++;
            terminal.style.zIndex = currentZIndex;
            
            // Only add prompt if terminal is empty (first time opening)
            if (terminalContent.children.length === 0) {
                addNewPrompt();
            }
        }

        function openMail() {
            const mailApp = document.getElementById('mail-app');
            mailApp.style.display = 'flex';
            mailApp.focus();
            
            // Bring mail app to front
            currentZIndex++;
            mailApp.style.zIndex = currentZIndex;
        }

        function closeMail() {
            const mailApp = document.getElementById('mail-app');
            mailApp.style.display = 'none';
        }

        function openDiscord() {
            window.open('https://discord.gg/RzGnytNDRR', '_blank');
        }

        // Close terminal function
        function closeTerminal() {
            const terminal = document.getElementById('terminal');
            terminal.style.display = 'none';
        }

        // Desktop selection functionality
        document.addEventListener('mousedown', function(e) {
            // Only start selection if clicking on empty desktop area
            if (e.target === document.body || e.target.classList.contains('selection-box')) {
                isSelecting = true;
                selectionStartX = e.clientX;
                selectionStartY = e.clientY;
                
                const selectionBox = document.getElementById('selection-box');
                selectionBox.style.left = selectionStartX + 'px';
                selectionBox.style.top = selectionStartY + 'px';
                selectionBox.style.width = '0px';
                selectionBox.style.height = '0px';
                selectionBox.style.display = 'block';
                
                // Clear previous selections
                selectedIcons.clear();
                document.querySelectorAll('.desktop-icon').forEach(icon => {
                    icon.classList.remove('selected', 'selected-multiple');
                });
            }
        });

        document.addEventListener('mousemove', function(e) {
            if (isSelecting) {
                const selectionBox = document.getElementById('selection-box');
                const currentX = e.clientX;
                const currentY = e.clientY;
                
                const left = Math.min(selectionStartX, currentX);
                const top = Math.min(selectionStartY, currentY);
                const width = Math.abs(currentX - selectionStartX);
                const height = Math.abs(currentY - selectionStartY);
                
                selectionBox.style.left = left + 'px';
                selectionBox.style.top = top + 'px';
                selectionBox.style.width = width + 'px';
                selectionBox.style.height = height + 'px';
                
                // Check which icons are in selection
                document.querySelectorAll('.desktop-icon').forEach(icon => {
                    const rect = icon.getBoundingClientRect();
                    const iconLeft = rect.left;
                    const iconTop = rect.top;
                    const iconRight = rect.right;
                    const iconBottom = rect.bottom;
                    
                    if (left < iconRight && left + width > iconLeft && 
                        top < iconBottom && top + height > iconTop) {
                        if (!selectedIcons.has(icon.id)) {
                            selectedIcons.add(icon.id);
                            icon.classList.add('selected-multiple');
                        }
                    } else {
                        if (selectedIcons.has(icon.id)) {
                            selectedIcons.delete(icon.id);
                            icon.classList.remove('selected-multiple');
                        }
                    }
                });
            }
        });

        document.addEventListener('mouseup', function(e) {
            if (isSelecting) {
                isSelecting = false;
                const selectionBox = document.getElementById('selection-box');
                selectionBox.style.display = 'none';
                
                // Don't auto-open selected icons - user needs to click/double-click them
            }
        });

        // Click outside to deselect icons
        document.addEventListener('click', function(e) {
            const terminalIcon = document.getElementById('terminal-icon');
            const mailIcon = document.getElementById('mail-icon');
            const discordIcon = document.getElementById('discord-icon');
            const terminal = document.getElementById('terminal');
            const mailApp = document.getElementById('mail-app');
            
            if (!terminalIcon.contains(e.target) && !mailIcon.contains(e.target) && !discordIcon.contains(e.target) && !terminal.contains(e.target) && !mailApp.contains(e.target)) {
                // Clear all selections
                terminalIcon.classList.remove('selected', 'selected-multiple');
                mailIcon.classList.remove('selected', 'selected-multiple');
                discordIcon.classList.remove('selected', 'selected-multiple');
                selectedIcons.clear();
            }
        });

        // Initialize
        addNewPrompt();
    </script>
</body>
</html>
